<Page
    x:Class="Test.DragControl.Views.EditPageView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Test.DragControl.Controls"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:utils="clr-namespace:Test.DragControl.Utils"
    Title="MainWindow"
    DataContext="{Binding EditPageVM, Source={StaticResource Locator}}">

    <Page.Resources>
        <utils:BindingProxy x:Key="BindingProxy" Data="{Binding}" />
        <utils:IntZeroToStringEmptyConverter x:Key="IntZeroToStringEmptyConverter" />

        <DataTemplate x:Key="ListeningMaterialTextContentDataTemplate">
            <controls:SuperTextBox
                Title="{Binding Title}"
                Height="260"
                AudioCurrentTime="{Binding Audio.AudioCurrentTime}"
                AudioProgressValue="{Binding Audio.AudioProgressValue}"
                AudioTotalTime="{Binding Audio.AudioTotalTime}"
                CommandParameter="{Binding}"
                IsMaleVoice="{Binding Audio.IsMaleVoice, Mode=TwoWay}"
                IsReadOneTime="{Binding Audio.IsReadOneTime, Mode=TwoWay}"
                PlayCommand="{Binding Data.PlayCommand, Source={StaticResource BindingProxy}}"
                Tag="{Binding Tag}"
                Text="{Binding Content, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                TextBoxType="{Binding ContentType}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MoveUp">
                        <i:InvokeCommandAction Command="{Binding Data.MoveUpCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MoveDown">
                        <i:InvokeCommandAction Command="{Binding Data.MoveDownCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="Remove">
                        <i:InvokeCommandAction Command="{Binding Data.RemoveCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SuperTextBox>
        </DataTemplate>

        <DataTemplate x:Key="ListeningMaterialPauseContentDataTemplate">
            <controls:SimpleTextBox
                Title="{Binding Title}"
                Height="80"
                Tag="{Binding Tag}"
                Text="{Binding PauseTime, Mode=TwoWay, Converter={StaticResource IntZeroToStringEmptyConverter}, UpdateSourceTrigger=PropertyChanged}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Play">
                        <i:InvokeCommandAction Command="{Binding Data.PlayCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MoveUp">
                        <i:InvokeCommandAction Command="{Binding Data.MoveUpCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MoveDown">
                        <i:InvokeCommandAction Command="{Binding Data.MoveDownCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                    <i:EventTrigger EventName="Remove">
                        <i:InvokeCommandAction Command="{Binding Data.RemoveCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SimpleTextBox>
        </DataTemplate>

    </Page.Resources>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding ViewLoadedCommand}" />
        </i:EventTrigger>
        <i:EventTrigger EventName="Unloaded">
            <i:InvokeCommandAction Command="{Binding ViewUnloadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <i:Interaction.Behaviors>
        <utils:LoseFocusOnLeftClickBehavior />
    </i:Interaction.Behaviors>

    <Grid Background="Green">
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="300" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <StackPanel
            Grid.ColumnSpan="2"
            Margin="20,10,0,0"
            HorizontalAlignment="Left"
            VerticalAlignment="Center"
            Orientation="Horizontal">
            <TextBlock VerticalAlignment="Center" Text="听力材料" />
            <TextBox
                Width="200"
                Height="30"
                Margin="5,0,25,0"
                Style="{StaticResource TextBoxStyle}"
                Text="{Binding ListeningMaterial.Title, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock VerticalAlignment="Center" Text="版本" />
            <TextBox
                Width="100"
                Height="20"
                Margin="5,0,25,0"
                Text="{Binding ListeningMaterial.Vision}" />
            <TextBlock VerticalAlignment="Center" Text="册次" />
            <TextBox
                Width="100"
                Height="20"
                Margin="5,0,25,0"
                Text="{Binding ListeningMaterial.Volume}" />
            <TextBlock VerticalAlignment="Center" Text="模块" />
            <TextBox
                Width="100"
                Height="20"
                Margin="5,0,0,0"
                Text="{Binding ListeningMaterial.Module}" />
        </StackPanel>
        <StackPanel
            Grid.ColumnSpan="2"
            Margin="0,10,20,0"
            HorizontalAlignment="Right"
            VerticalAlignment="Center"
            Orientation="Horizontal">
            <Button
                Width="100"
                Height="30"
                Command="{Binding GobackCommand}"
                Content="Goback" />
            <Button
                Width="100"
                Height="30"
                Margin="10,0,0,0"
                Command="{Binding SaveCommand}"
                Content="Save" />
        </StackPanel>

        <ListBox
            Grid.Row="1"
            Margin="0,10,0,0"
            Background="Transparent"
            ItemsSource="{Binding ListeningMaterial.ContentList}"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplateSelector>
                <utils:ListeningMaterialDataTemplateSelector ListeningMaterialPauseContentDataTemplate="{StaticResource ListeningMaterialPauseContentDataTemplate}" ListeningMaterialTextContentDataTemplate="{StaticResource ListeningMaterialTextContentDataTemplate}" />
            </ListBox.ItemTemplateSelector>
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <hc:SimpleStackPanel />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <i:Interaction.Behaviors>
                <utils:ListBoxScrollIntoViewBehavior />
            </i:Interaction.Behaviors>
        </ListBox>

        <StackPanel
            Grid.Row="1"
            Grid.Column="1"
            Margin="0,10,0,0"
            Background="Yellow"
            Orientation="Vertical">
            <controls:SuperTextBox
                x:Name="instruction"
                Title="指导语"
                Width="200"
                Height="100"
                Margin="0,0,0,20"
                IsReadOnly="True"
                Tag="这里是指导语材料"
                TextBoxType="2">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Add">
                        <i:InvokeCommandAction Command="{Binding Data.AddCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding ElementName=instruction, Path=TextBoxType}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SuperTextBox>
            <controls:SuperTextBox
                x:Name="monologue"
                Title="独白"
                Width="200"
                Height="100"
                Margin="0,0,0,20"
                IsReadOnly="True"
                Tag="这里是独白材料"
                TextBoxType="0">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Add">
                        <i:InvokeCommandAction Command="{Binding Data.AddCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding ElementName=monologue, Path=TextBoxType}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SuperTextBox>
            <controls:SuperTextBox
                x:Name="dialogue"
                Title="对话"
                Width="200"
                Height="100"
                Margin="0,0,0,20"
                IsReadOnly="True"
                Tag="这里是对话材料"
                TextBoxType="1">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Add">
                        <i:InvokeCommandAction Command="{Binding Data.AddCommand, Source={StaticResource BindingProxy}}" CommandParameter="{Binding ElementName=dialogue, Path=TextBoxType}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SuperTextBox>
            <controls:SimpleTextBox
                Title="停顿时长"
                Width="200"
                Height="100"
                IsReadOnly="True">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Add">
                        <i:InvokeCommandAction Command="{Binding Data.AddCommand, Source={StaticResource BindingProxy}}">
                            <i:InvokeCommandAction.CommandParameter>
                                <sys:Int32>-1</sys:Int32>
                            </i:InvokeCommandAction.CommandParameter>
                        </i:InvokeCommandAction>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </controls:SimpleTextBox>
        </StackPanel>
    </Grid>
</Page>
